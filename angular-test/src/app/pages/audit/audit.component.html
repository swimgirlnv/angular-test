<mat-tab-group>
  <!-- Document Lineage Tab -->
  <mat-tab label="Document Lineage">
    <div class="grid tab-content">
      <mat-card class="material-card">
        <h3 class="tab-header">
          <mat-icon color="primary">timeline</mat-icon>
          Document Processing Timeline
        </h3>

        <div class="timeline" role="list" aria-label="Document processing timeline">
          @for (event of auditEvents(); track event.id) {
            <article
              class="timeline-item"
              role="listitem"
              [attr.aria-label]="'Timeline event: ' + event.action + ' for ' + event.document">

              <div class="timeline-dot" aria-hidden="true"></div>

              <header class="audit-header">
                <div>
                  <h4 class="action-label" [class]="getActionClass(event.action)">
                    {{ event.action }}
                  </h4>
                  <div class="audit-document">
                    {{ event.document }} -
                    <time [dateTime]="event.timestamp">{{ event.timestamp | date:'medium' }}</time>
                  </div>
                </div>
                <mat-chip
                  [class]="'confidence-chip ' + getConfidenceClass(event.confidence)"
                  [attr.aria-label]="'Confidence level: ' + event.confidence + ' percent'">
                  {{ event.confidence }}% confidence
                </mat-chip>
              </header>

              <div class="audit-details">{{ event.details }}</div>
            </article>
          }
        </div>
      </mat-card>
    </div>
  </mat-tab>

  <!-- AI Decisions Tab -->
  <mat-tab label="AI Decisions">
    <div class="grid tab-content">
      <mat-card class="material-card">
        <h3 class="tab-header">
          <mat-icon color="primary">psychology</mat-icon>
          AI Processing Decisions
        </h3>

        <div role="list" aria-label="AI processing decisions">
          @for (decision of aiDecisions(); track decision.id) {
            <article
              class="audit-item"
              role="listitem"
              [attr.aria-label]="'AI decision for ' + decision.document + ' by ' + decision.model">

              <header class="audit-header">
                <div>
                  <div class="ai-decision-model">{{ decision.model }}</div>
                  <div class="ai-decision-document">{{ decision.document }}</div>
                </div>
                <mat-chip
                  [class]="'confidence-chip ' + getConfidenceClass(decision.confidence)"
                  [attr.aria-label]="'Accuracy: ' + decision.confidence + ' percent'">
                  {{ decision.confidence }}% accuracy
                </mat-chip>
              </header>

              <div class="ai-decision-extracted">
                <strong>Extracted:</strong> {{ decision.extracted }}
              </div>

              <div class="audit-timestamp">
                <time [dateTime]="decision.timestamp">{{ decision.timestamp | date:'medium' }}</time>
              </div>
            </article>
          }
        </div>
      </mat-card>
    </div>
  </mat-tab>

  <!-- Compliance Tab -->
  <mat-tab label="Compliance">
    <div class="grid tab-content">
      <mat-card class="material-card">
        <h3 class="tab-header">
          <mat-icon color="primary">verified_user</mat-icon>
          Compliance & Audit Trail
        </h3>

        <table
          mat-table
          [dataSource]="complianceRecords()"
          class="audit-table mat-elevation-z1"
          aria-label="Compliance records table">

          <!-- Document Column -->
          <ng-container matColumnDef="document">
            <th mat-header-cell *matHeaderCellDef scope="col">Document</th>
            <td mat-cell *matCellDef="let record">
              <div class="document-info">
                <span class="document-type" [class]="getDocumentTypeClass(record.document)">
                  {{ getDocumentType(record.document) }}
                </span>
                <div>{{ record.document }}</div>
              </div>
            </td>
          </ng-container>

          <!-- Action Column -->
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef scope="col">Action</th>
            <td mat-cell *matCellDef="let record">
              <span class="action-label" [class]="getActionClass(record.action)">
                {{ record.action }}
              </span>
            </td>
          </ng-container>

          <!-- User Column -->
          <ng-container matColumnDef="user">
            <th mat-header-cell *matHeaderCellDef scope="col">User</th>
            <td mat-cell *matCellDef="let record">
              <div class="user-info">
                <div class="user-avatar" [attr.aria-label]="'User avatar for ' + record.user">
                  {{ getUserInitials(record.user) }}
                </div>
                <span>{{ record.user }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Timestamp Column -->
          <ng-container matColumnDef="timestamp">
            <th mat-header-cell *matHeaderCellDef scope="col">Timestamp</th>
            <td mat-cell *matCellDef="let record">
              <time [dateTime]="record.timestamp">{{ record.timestamp | date:'medium' }}</time>
            </td>
          </ng-container>

          <!-- Compliance Column -->
          <ng-container matColumnDef="compliance">
            <th mat-header-cell *matHeaderCellDef scope="col">Compliance Status</th>
            <td mat-cell *matCellDef="let record">
              <mat-chip
                [color]="record.compliant ? 'primary' : 'warn'"
                [class]="'compliance-chip ' + (record.compliant ? 'compliant' : 'non-compliant')"
                [attr.aria-label]="'Compliance status: ' + (record.compliant ? 'Compliant' : 'Review Required')">
                <mat-icon class="compliance-icon">
                  {{ record.compliant ? 'check_circle' : 'warning' }}
                </mat-icon>
                {{ record.compliant ? 'Compliant' : 'Review Required' }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Table Headers and Rows -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns;"
            [attr.aria-label]="'Compliance record for ' + row.document">
          </tr>
        </table>

        <!-- Empty State -->
        @if (complianceRecords().length === 0) {
          <div class="empty-state" style="text-align: center; padding: 40px; opacity: 0.6;">
            <mat-icon style="font-size: 48px; margin-bottom: 16px;">description</mat-icon>
            <h4>No compliance records found</h4>
            <p>Compliance records will appear here as documents are processed.</p>
          </div>
        }
      </mat-card>
    </div>
  </mat-tab>
</mat-tab-group>
